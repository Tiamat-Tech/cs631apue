.Dd October 26, 2021
.Dt COMMAND 3
.Os
.Sh NAME
.Nm command
.Nd pass a command to the shell and return stdout and stderr
.Sh SYNOPSIS
.In command.h
.Ft int
.Fn command "const char *string" "char *outbuf" "int outlen" "char *errbuf" "int errlen"
.Sh DESCRIPTION
The
.Fn command
function
hands the argument
.Fa string
to the command interpreter
.Xr sh 1 .
Any output generated by the command on stdout is
placed into the buffer
.Ar outbuf ;
any output generated on stderr is placed into the
buffer
.Ar errbuf .
In either case,
.Fn command
will only write up to
.Ar outlen
and
.Ar errlen
bytes to the respective buffers.
.Pp
The calling process waits for the shell to finish executing the command,
ignoring
.Dv SIGINT
and
.Dv SIGQUIT ,
and blocking
.Dv SIGCHLD .
.Pp
If
.Fa string
is a
.Dv NULL
pointer,
.Fn command
will return non-zero, if the command interpreter is available, or zero if none
is available.
Otherwise,
.Fn command
returns the termination status of the shell in the format specified by
.Xr waitpid 2 .
.Pp
Note that
.Nm
does not necessarily
.Dv NUL Ns No -terminate
.Ar outbuf
or
.Ar errbuf .
If the output to be placed into these buffers is
larger than
.Ar outlen / errlen ,
then
.Nm
would exactly fill the buffer(s).
The caller should
.Dv NUL Ns No -terminate
these buffers explicitly:
.Bd -literal -offset indent
command(cmd, out, outlen - 1, err, errlen - 1);
out[outlen-1] = '\e0';
err[errlen-1] = '\e0';
.Ed
.Sh RETURN VALUES
If a child process cannot be created, or the termination status of
the shell cannot be obtained,
.Fn command
returns -1 and sets
.Va errno
to indicate the error.
If execution of the shell fails,
.Fn command
returns the termination status for a program that terminates with a call of
.Fn exit 127 .
.Sh SEE ALSO
.Xr sh 1 ,
.Xr dup2 2 ,
.Xr execve 2 ,
.Xr pipe 2 ,
.Xr waitpid 2 ,
.Xr popen 3 ,
.Xr shquote 3 ,
.Xr system 3
.Pp
.Ar /usr/src/lib/libc/stdlib/system.c
.Sh HISTORY
The
.Fn command
function
was first used as an in-class exercise for the class
CS631 Advanced Programming in the UNIX Environment at
Stevens Institute of Technology in the Fall of 2018.
